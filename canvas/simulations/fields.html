<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fields Simulation</title>
</head>
<body>

<div>
    <button id="pause">Pause</button>
</div>
<div>
    <canvas id="canvas" style="border: 1px solid purple">

    </canvas>
</div>


<script type="importmap">
    {
        "imports": {
            "tdsim/": "../../build/tdsim/",
            "tdsim": "../../build/tdsim/entry.js"
        }
    }

</script>
<script type="module">
    import {Loader} from "../../build/tdsim/canvas/loader.js";
    import {TDCanvas} from "../../build/tdsim/canvas/canvas.js";
    import {Fields} from "../../build/tdsim/sims/objects/physical.js";

    function autopause(setPause) {
        let hasFocus = true;
        setInterval(() => {
            const newFocus = document.hasFocus();
            if (newFocus !== hasFocus) {
                setPause(!newFocus);
            }
            hasFocus = newFocus;
        }, 500);
    }


    async function main() {
        // create canvas
        const canvas = new TDCanvas(
            document.getElementById('canvas'),
            {
                rate: {
                    update: 120,
                },
                attachments: {
                    axis: true,
                    labels: true,
                    counter: true
                },
                region: {
                    right: 0.5,
                    top: 0.5,
                    scale: 50
                }
            }
        );

        const loader = new Loader({
            autostart: true,
        });
        const controls = await loader.inject(canvas, canvas => {
            const field = new Fields.ScalarFieldIndependent(
                (x, y) => Math.sin(2*Math.sqrt((x+4)**2 + y**2)),
                undefined,
                {
                    location: [-8, -4],
                    size: [8, 8],
                    xSize: 80,
                    ySize: 80
                }
            );
            canvas.addElement(field);

            const field2 = new Fields.ScalarField(
                (x, y, t) => Math.sin(2*Math.sqrt((x-4)**2 + y**2) - 2 *t),
                undefined,
                {
                    location: [0, -4],
                    size: [8, 8],
                    xSize: 100,
                    ySize: 100
                }
            )
            canvas.addElement(field2);

            // const pendulum = new TDDoublePendulum(
            //     0.8, 0.8, [0, 0], [3, 3], 1, 1, 1, 1, 0.25, '#000000', 0, 0
            // );
            // canvas.addElement(pendulum);
        });

        document.getElementById('pause').addEventListener('click', controls.pause);
        // autopause(controls.pause);

    }

    document.addEventListener('DOMContentLoaded', main);
</script>

</body>
</html>
