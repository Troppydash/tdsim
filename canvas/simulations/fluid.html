<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Fluid Simulation</title>

    <style>
        body {
            overflow: hidden;
        }

        canvas {
            border: 1px solid black;
            display: block;
            position: absolute;
            inset: 0;
        }
    </style>
</head>
<body>

<canvas id="root"></canvas>

<script type="module">
    import {TDCanvas} from "../../build/tdsim/canvas/canvas.js";
    import {Loader} from "../../build/tdsim/canvas/loader.js";
    import {Fields} from "../../build/tdsim/sims/objects/physical.js";

    async function main() {
        const canvas = new TDCanvas(
            document.getElementById('root'),
            {
                attachments: {
                    // axis: true,
                    // counter: true,
                    // labels: true
                },

                region: {
                    top: 1,
                    right: 1,
                    scale: 300
                },
                rate: {
                    update: 15,
                },
                size: {
                    width: window.innerWidth,
                    height: window.innerHeight
                }
            }
        );

        const loader = new Loader()
        const controls = await loader.inject(canvas, cvs => {
            const size = 0.05;
            const canvasArea = cvs.drawableArea();
            const field = new Fields.FluidField({
                location: [size,size],
                fieldSize: [Math.floor(canvasArea[0] / size) - 2, Math.floor(canvasArea[1] / size) - 2],
                cellSize: size,
                drawModes: [Fields.FluidDrawMode.DENSITY, Fields.FluidDrawMode.CELL]
            });

            const wall = (i, j) => {
                if (Math.abs(i - 40) < 3 && j > 10 && j < 30) {
                    return {
                        cell: Fields.CellType.WALL,
                        u: 0,
                        v: 0
                    }
                }
                return null;
            }

            // const smokeBall = (i, j)  => {
            //     if ((i - 15) ** 2 + (j - 25) ** 2 <= 9 ** 2) {
            //         return {
            //             density: 1
            //         }
            //     }
            //     return null;
            // }

            field.addObject(Fields.FluidFieldObjects.walls);
            // field.addObject(smokeBall);
            field.addObject(wall);

            cvs.addElement(field);
        })
    }

    document.addEventListener('DOMContentLoaded', main);

</script>

</body>
</html>
